<div class="modal-backdrop" role="button" tabindex="0" (click)="onCancel()" (keydown.escape)="onCancel()">
  <div class="modal-container" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()" role="dialog" aria-modal="true">
    <!-- Header -->
    <div class="modal-header">
      <h3>ðŸ”— Why does this connect?</h3>
      <div class="link-preview">
        <span class="node-label">{{ sourceLabel }}</span>
        <span class="link-arrow">â†’</span>
        <span class="node-label">{{ targetLabel }}</span>
      </div>
    </div>

    <!-- Connection Type -->
    <div class="modal-section">
      <span class="section-label">Connection Type</span>
      <div class="type-grid">
        @for (ct of connectionTypes; track ct) {
          <button class="brutal-btn type-btn"
            [class.active]="connectionType() === ct.value" (click)="connectionType.set(ct.value)">
            {{ ct.icon }} {{ ct.label }}
          </button>
        }
      </div>
    </div>

    <!-- Strength -->
    <div class="modal-section">
      <span class="section-label">Strength</span>
      <div class="strength-row">
        @for (sl of strengthLevels; track sl) {
          <button class="brutal-btn strength-btn"
            [class.active]="strength() === sl.value" (click)="strength.set(sl.value)">
            {{ sl.label }}
          </button>
        }
      </div>
    </div>

    <!-- Suggested Tokens -->
    @if (suggestedTokens.length > 0) {
      <div class="modal-section">
        <span class="section-label">Shared Keywords Found</span>
        <div class="token-chips">
          @for (token of suggestedTokens; track token) {
            <button class="token-chip" (click)="useSuggestedToken(token)"
              title="Click to add to reason">
              {{ token }}
            </button>
          }
        </div>
      </div>
    }

    <!-- Reason -->
    <div class="modal-section">
      <label>
        <span class="section-label">Reasoning <span class="required">*</span></span>
        <textarea class="reason-input" placeholder="Why do these pieces connect? (min 5 chars)" [ngModel]="reason()"
        (ngModelChange)="reason.set($event)" rows="3"></textarea>
      </label>
      @if (reason().length > 0 && reason().length < 5) {
        <span class="hint-text">
          {{ 5 - reason().length }} more characters needed
        </span>
      }
    </div>

    <!-- Actions -->
    <div class="modal-actions">
      <button class="brutal-btn cancel-btn" (click)="onCancel()">Cancel</button>
      <button class="brutal-btn confirm-btn" [disabled]="!isValid" (click)="onConfirm()">
        Confirm Link
      </button>
    </div>
  </div>
</div>